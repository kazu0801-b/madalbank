# MedalBank ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰API ç¢ºèªã‚¬ã‚¤ãƒ‰

## ğŸ“‹ ä½•ã‚’ä½œã£ãŸã®ã‹

### ä½œæˆã—ãŸã‚‚ã®
**MedalBank MVPç‰ˆã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰API** - ãƒ¡ãƒ€ãƒ«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã®ã‚µãƒ¼ãƒãƒ¼éƒ¨åˆ†

### æŠ€è¡“æ§‹æˆ
- **è¨€èª**: Node.js + JavaScript
- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: Express.js 4.x
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: SQLite3ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ï¼‰
- **ãƒãƒ¼ãƒˆ**: 8000

### æä¾›æ©Ÿèƒ½
1. **ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼**ï¼ˆç°¡æ˜“ç‰ˆï¼‰
2. **ãƒ¡ãƒ€ãƒ«æ®‹é«˜ç®¡ç†**
3. **å…¥é‡‘ãƒ»æ‰•ã„å‡ºã—å‡¦ç†**
4. **å–å¼•å±¥æ­´è¨˜éŒ²ãƒ»è¡¨ç¤º**

## ğŸ— ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ (Next.js:3000)
      â†• HTTP ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰API (Express:8000)
      â†• SQL ã‚¯ã‚¨ãƒª
ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ (SQLite:medalbank.db)
```

### ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ
```
medalbank-api/
â”œâ”€â”€ server.js              # ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒãƒ¼ï¼ˆèµ·å‹•ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”œâ”€â”€ database.js            # DBåˆæœŸåŒ–ãƒ»æ¥ç¶šç®¡ç†
â”œâ”€â”€ medalbank.db           # SQLiteãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ package.json           # Node.jsè¨­å®š
â”œâ”€â”€ .env                   # ç’°å¢ƒå¤‰æ•°
â””â”€â”€ routes/                # API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
    â”œâ”€â”€ auth.js            # èªè¨¼APIï¼ˆãƒ­ã‚°ã‚¤ãƒ³ãƒ»ãƒ­ã‚°ã‚¢ã‚¦ãƒˆï¼‰
    â”œâ”€â”€ balance.js         # æ®‹é«˜APIï¼ˆæ®‹é«˜å–å¾—ï¼‰
    â””â”€â”€ transactions.js    # å–å¼•APIï¼ˆå…¥é‡‘ãƒ»æ‰•ã„å‡ºã—ãƒ»å±¥æ­´ï¼‰
```

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ 
```sql
users          balance         transactions
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id      â”‚    â”‚ user_id â”‚â”€â”€â”€â”€â†’â”‚ user_id     â”‚
â”‚ usernameâ”‚    â”‚ amount  â”‚     â”‚ type        â”‚
â”‚ email   â”‚    â”‚updated_at     â”‚ amount      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ balance_beforeâ”‚
                                â”‚ balance_after â”‚
                                â”‚ created_at   â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ å‹•ä½œç¢ºèªæ–¹æ³•

### å‰ææ¡ä»¶
```bash
# 1. APIã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨
cd medalbank-api
npm start

# 2. ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ãŒ2ã¤å¿…è¦
# - ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ç”¨
# - ãƒ†ã‚¹ãƒˆã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œç”¨
```

### åŸºæœ¬ç¢ºèªæ‰‹é †

#### 1. ã‚µãƒ¼ãƒãƒ¼æ­£å¸¸æ€§ç¢ºèª
```bash
# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ï¼ˆã‚µãƒ¼ãƒãƒ¼ãŒç”Ÿãã¦ã„ã‚‹ã‹ï¼‰
curl http://localhost:8000/health

# æœŸå¾…ã•ã‚Œã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹:
{
  "status": "OK",
  "message": "MedalBank API is running!",
  "timestamp": "2025-01-01T12:00:00.000Z"
}
```

#### 2. èªè¨¼æ©Ÿèƒ½ç¢ºèª
```bash
# ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆMVPç‰ˆã¯ç°¡æ˜“èªè¨¼ï¼‰
curl -X POST http://localhost:8000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"testuser"}'

# æœŸå¾…ã•ã‚Œã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹:
{
  "message": "ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ",
  "user": {
    "id": 1,
    "username": "testuser",
    "email": "test@example.com"
  },
  "token": "mvp_token_1_xxxxxxxxxx"
}
```

#### 3. æ®‹é«˜ç¢ºèª
```bash
# ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼(ID=1)ã®ç¾åœ¨æ®‹é«˜ã‚’å–å¾—
curl http://localhost:8000/api/balance/1

# æœŸå¾…ã•ã‚Œã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹:
{
  "user_id": 1,
  "username": "testuser",
  "total_balance": 1000,  # åˆæœŸå€¤1000ãƒ¡ãƒ€ãƒ«
  "updated_at": "2025-01-01 12:00:00",
  "message": "æ®‹é«˜å–å¾—æˆåŠŸ"
}
```

#### 4. å…¥é‡‘å‡¦ç†ç¢ºèª
```bash
# 500ãƒ¡ãƒ€ãƒ«å…¥é‡‘
curl -X POST http://localhost:8000/api/transactions \
  -H "Content-Type: application/json" \
  -d '{"user_id":1,"type":"deposit","amount":500,"description":"ãƒ†ã‚¹ãƒˆå…¥é‡‘"}'

# æœŸå¾…ã•ã‚Œã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹:
{
  "transaction_id": 1,
  "user_id": 1,
  "type": "deposit",
  "amount": 500,
  "balance_before": 1000,  # å…¥é‡‘å‰æ®‹é«˜
  "balance_after": 1500,   # å…¥é‡‘å¾Œæ®‹é«˜
  "message": "å…¥é‡‘ãŒå®Œäº†ã—ã¾ã—ãŸ"
}
```

#### 5. æ‰•ã„å‡ºã—å‡¦ç†ç¢ºèª
```bash
# 200ãƒ¡ãƒ€ãƒ«æ‰•ã„å‡ºã—
curl -X POST http://localhost:8000/api/transactions \
  -H "Content-Type: application/json" \
  -d '{"user_id":1,"type":"withdraw","amount":200,"description":"ãƒ†ã‚¹ãƒˆæ‰•ã„å‡ºã—"}'

# æœŸå¾…ã•ã‚Œã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹:
{
  "transaction_id": 2,
  "user_id": 1,
  "type": "withdraw", 
  "amount": 200,
  "balance_before": 1500,  # æ‰•ã„å‡ºã—å‰æ®‹é«˜
  "balance_after": 1300,   # æ‰•ã„å‡ºã—å¾Œæ®‹é«˜
  "message": "æ‰•ã„å‡ºã—ãŒå®Œäº†ã—ã¾ã—ãŸ"
}
```

#### 6. å–å¼•å±¥æ­´ç¢ºèª
```bash
# æœ€æ–°5ä»¶ã®å–å¼•å±¥æ­´ã‚’å–å¾—
curl "http://localhost:8000/api/transactions?userId=1&limit=5"

# æœŸå¾…ã•ã‚Œã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹:
{
  "user_id": 1,
  "transactions": [
    {
      "id": 2,
      "type": "withdraw",
      "amount": 200,
      "balance_before": 1500,
      "balance_after": 1300,
      "description": "ãƒ†ã‚¹ãƒˆæ‰•ã„å‡ºã—",
      "created_at": "2025-01-01 12:05:00"
    },
    {
      "id": 1,
      "type": "deposit", 
      "amount": 500,
      "balance_before": 1000,
      "balance_after": 1500,
      "description": "ãƒ†ã‚¹ãƒˆå…¥é‡‘",
      "created_at": "2025-01-01 12:03:00"
    }
  ],
  "count": 2,
  "message": "å–å¼•å±¥æ­´å–å¾—æˆåŠŸ"
}
```

#### 7. æœ€çµ‚æ®‹é«˜ç¢ºèª
```bash
# å–å¼•å¾Œã®æœ€çµ‚æ®‹é«˜ã‚’ç¢ºèª
curl http://localhost:8000/api/balance/1

# æœŸå¾…ã•ã‚Œã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹:
{
  "user_id": 1,
  "username": "testuser", 
  "total_balance": 1300,   # 1000 + 500 - 200 = 1300
  "updated_at": "2025-01-01 12:05:00",
  "message": "æ®‹é«˜å–å¾—æˆåŠŸ"
}
```

### ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ç¢ºèª

#### 1. å­˜åœ¨ã—ãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼
```bash
curl http://localhost:8000/api/balance/999

# æœŸå¾…ã•ã‚Œã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹:
{
  "error": "ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“",
  "userId": 999,
  "hint": "MVPç‰ˆã§ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ID=1ã®ã¿åˆ©ç”¨å¯èƒ½ã§ã™"
}
```

#### 2. æ®‹é«˜ä¸è¶³ã‚¨ãƒ©ãƒ¼
```bash
# æ®‹é«˜ä»¥ä¸Šã®é‡‘é¡ã‚’æ‰•ã„å‡ºã—
curl -X POST http://localhost:8000/api/transactions \
  -H "Content-Type: application/json" \
  -d '{"user_id":1,"type":"withdraw","amount":9999}'

# æœŸå¾…ã•ã‚Œã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹:
{
  "error": "æ®‹é«˜ä¸è¶³ã§ã™",
  "current_balance": 1300,
  "requested_amount": 9999,
  "shortage": 8699
}
```

#### 3. ç„¡åŠ¹ãªãƒ­ã‚°ã‚¤ãƒ³
```bash
curl -X POST http://localhost:8000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"invalid"}'

# æœŸå¾…ã•ã‚Œã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹:
{
  "error": "ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“",
  "username": "invalid",
  "hint": "MVPç‰ˆã§ã¯ \"testuser\" ã®ã¿åˆ©ç”¨å¯èƒ½ã§ã™"
}
```

## ğŸ“Š ã‚µãƒ¼ãƒãƒ¼ãƒ­ã‚°ã®èª­ã¿æ–¹

### æ­£å¸¸æ™‚ã®ãƒ­ã‚°ä¾‹
```
ğŸš€ MedalBank API Server running on http://localhost:8000
âœ… SQLite ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ¥ç¶šã—ã¾ã—ãŸ
âœ… ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼æ—¢ã«å­˜åœ¨ã—ã¾ã™ (ID: 1)
ğŸ“¥ GET /api/balance/1
âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ testuser ã®æ®‹é«˜: 1000ãƒ¡ãƒ€ãƒ«
ğŸ“¥ POST /api/transactions
ğŸ“¥ å–å¼•å‡¦ç†ãƒªã‚¯ã‚¨ã‚¹ãƒˆ: ãƒ¦ãƒ¼ã‚¶ãƒ¼ID=1, ç¨®åˆ¥=deposit, é‡‘é¡=500
ğŸ” ãƒ¦ãƒ¼ã‚¶ãƒ¼ID 1 ã®ç¾åœ¨æ®‹é«˜ã‚’å–å¾—ä¸­...
ğŸ’° å…¥é‡‘å‡¦ç†: 1000 + 500 = 1500
ğŸ”„ æ®‹é«˜ã‚’ 1000 â†’ 1500 ã«æ›´æ–°ä¸­...
ğŸ“ å–å¼•å±¥æ­´ã‚’è¨˜éŒ²ä¸­...
âœ… å–å¼•å®Œäº†: ID=1, æ–°æ®‹é«˜=1500ãƒ¡ãƒ€ãƒ«
```

### ãƒ­ã‚°ã®è¦‹æ–¹
- ğŸš€ = ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
- âœ… = æ­£å¸¸å‡¦ç†å®Œäº†
- ğŸ“¥ = APIãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡
- ğŸ” = ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¤œç´¢ä¸­
- ğŸ’° = å…¥é‡‘å‡¦ç†
- ğŸ’¸ = æ‰•ã„å‡ºã—å‡¦ç†  
- ğŸ”„ = ãƒ‡ãƒ¼ã‚¿æ›´æ–°ä¸­
- ğŸ“ = å±¥æ­´è¨˜éŒ²ä¸­
- âš ï¸ = è­¦å‘Šãƒ»ã‚¨ãƒ©ãƒ¼
- âŒ = å‡¦ç†å¤±æ•—

## ğŸ” ãƒ‡ãƒãƒƒã‚°æ–¹æ³•

### ã‚ˆãã‚ã‚‹å•é¡Œã¨å¯¾å‡¦æ³•

#### 1. ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ãªã„
```bash
# ãƒãƒ¼ãƒˆ8000ãŒä½¿ç”¨ã•ã‚Œã¦ã„ãªã„ã‹ç¢ºèª
lsof -i :8000

# ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹å ´åˆã€ãƒ—ãƒ­ã‚»ã‚¹ã‚’çµ‚äº†
kill -9 [PID]

# ä¾å­˜é–¢ä¿‚ã‚’å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
rm -rf node_modules package-lock.json
npm install
```

#### 2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼
```bash
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã—ã¦åˆæœŸåŒ–
rm medalbank.db
npm start  # è‡ªå‹•ã§ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ»ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ãŒå†ä½œæˆã•ã‚Œã‚‹
```

#### 3. APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒè¿”ã‚‰ãªã„
```bash
# CURLã‚³ãƒãƒ³ãƒ‰ã§ç›´æ¥ç¢ºèª
curl -v http://localhost:8000/health

# ã‚µãƒ¼ãƒãƒ¼ãƒ­ã‚°ã‚’ç¢ºèª
# ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã®ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ç”»é¢ã§ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒã‚§ãƒƒã‚¯
```

## ğŸ¯ ç¢ºèªã®ãƒã‚¤ãƒ³ãƒˆ

### æˆåŠŸã®åˆ¤æ–­åŸºæº–
1. **ã‚µãƒ¼ãƒãƒ¼èµ·å‹•**: ãƒ­ã‚°ã« "ğŸš€ MedalBank API Server running" ãŒè¡¨ç¤º
2. **DBåˆæœŸåŒ–**: "âœ… ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆå®Œäº†" ã¾ãŸã¯ "æ—¢ã«å­˜åœ¨ã—ã¾ã™" ãŒè¡¨ç¤º
3. **APIå¿œç­”**: å„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒJSONã‚’è¿”ã™
4. **ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§**: æ®‹é«˜è¨ˆç®—ãŒæ­£ç¢ºï¼ˆå…¥é‡‘ã§å¢—åŠ ã€æ‰•ã„å‡ºã—ã§æ¸›å°‘ï¼‰
5. **å±¥æ­´è¨˜éŒ²**: å–å¼•å±¥æ­´ãŒæ­£ã—ã„é †åºã§è¨˜éŒ²ã•ã‚Œã‚‹

### æ³¨æ„äº‹é …
- **MVPç‰ˆã®åˆ¶é™**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ID=1ï¼ˆtestuserï¼‰ã®ã¿å¯¾å¿œ
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: æœ¬æ ¼çš„ãªèªè¨¼ãªã—ï¼ˆé–‹ç™ºç”¨ï¼‰
- **ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–**: SQLiteãƒ•ã‚¡ã‚¤ãƒ«ã«ãƒ‡ãƒ¼ã‚¿ä¿å­˜

## ğŸ”„ æ—¥å¸¸çš„ãªç¢ºèªæ‰‹é †

```bash
# 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
cd medalbank-api

# 2. ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
npm start

# 3. åˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§åŸºæœ¬ãƒã‚§ãƒƒã‚¯ï¼ˆ30ç§’ã§å®Œäº†ï¼‰
curl http://localhost:8000/health
curl http://localhost:8000/api/balance/1
curl -X POST http://localhost:8000/api/transactions -H "Content-Type: application/json" -d '{"user_id":1,"type":"deposit","amount":100}'
curl http://localhost:8000/api/balance/1

# 4. å•é¡Œãªã‘ã‚Œã°é–‹ç™ºç¶šè¡Œã€å•é¡ŒãŒã‚ã‚Œã°ãƒ­ã‚°ç¢ºèª
```

ã“ã®æ‰‹é †ã§**ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã‚‹**ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚